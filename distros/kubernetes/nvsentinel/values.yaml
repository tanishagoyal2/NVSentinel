# Copyright (c) 2025, NVIDIA CORPORATION.  All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

global:
  dryRun: false
  image:
    tag: "main"
  initContainerImage:
    repository: docker.io/bitnamilegacy/os-shell
    tag: "12-debian-12-r30"
    pullPolicy: IfNotPresent
  metricsPort: 2112

  # Datastore configuration
  # By default, datastore is not configured (use mongodb-config ConfigMap directly)
  # To use the centralized datastore configuration, uncomment and configure below
  # datastore:
  #   provider: "mongodb"  # or "postgresql"
  #   connection:
  #     host: "mongodb"
  #     port: 27017
  #     database: "nvsentinel"

  # Shared metadata path used by metadata-collector and syslog-health-monitor
  metadataPath: /var/lib/nvsentinel/gpu_metadata.json

  nodeSelector: {}
  tolerations: []
  affinity: {}
  systemNodeSelector: {}
  systemNodeTolerations: []
  imagePullSecrets: []

  gpuHealthMonitor:
    enabled: true
  healthEventsAnalyzer:
    enabled: false
  faultQuarantine:
    enabled: false
  nodeDrainer:
    enabled: false
  faultRemediation:
    enabled: false
  janitor:
    enabled: false
  cspHealthMonitor:
    enabled: false
  syslogHealthMonitor:
    enabled: true
  labeler:
    enabled: true
  metadataCollector:
    enabled: true
  inclusterFileServer:
    enabled: false
    metricsPort: 9001
    cleanupMetricsPort: 9002
  mongodbStore:
    enabled: false
  kubernetesObjectMonitor:
    enabled: false
  eventExporter:
    enabled: false

platformConnector:
  image:
    repository: ghcr.io/nvidia/nvsentinel/platform-connectors
    pullPolicy: IfNotPresent
    tag: ""

  resources:
    limits:
      cpu: 200m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 512Mi

  podAnnotations: {}

  tolerations: []

  logLevel: info

  mongodbStore:
    enabled: false
    clientCertMountPath: "/etc/ssl/mongo-client"

  postgresqlStore:
    clientCertMountPath: "/etc/ssl/client-certs"

  k8sConnector:
    enabled: true
    qps: 5.0
    burst: 10

  # Node metadata enrichment configuration
  nodeMetadata:
    enabled: false
    cacheSize: 50
    cacheTTLSeconds: 3600
    allowedLabels:
      - "topology.kubernetes.io/zone"
      - "topology.kubernetes.io/region"
      - "node.kubernetes.io/instance-type"
      - "nvidia.com/cuda.driver-version.major"
      - "nvidia.com/cuda.driver-version.minor"
      - "nvidia.com/cuda.driver-version.revision"
      - "nvidia.com/cuda.driver-version.full"
      - "nvidia.com/cuda.runtime-version.major"
      - "nvidia.com/cuda.runtime-version.minor"
      - "nvidia.com/cuda.runtime-version.full"
      - "topology.k8s.aws/capacity-block-id"
      - "topology.k8s.aws/network-node-layer-1"
      - "topology.k8s.aws/network-node-layer-2"
      - "topology.k8s.aws/network-node-layer-3"
      - "oci.oraclecloud.com/host.id"
      - "oci.oraclecloud.com/host.network_block_id"
      - "oci.oraclecloud.com/host.rack_id"
      - "oci.oraclecloud.com/host.serial_number"
      - "cloud.google.com/gce-topology-block"
      - "cloud.google.com/gce-topology-host"
      - "cloud.google.com/gce-topology-subblock"

socketPath: "/var/run/nvsentinel.sock"

# Node condition cleanup hook configuration
nodeConditionCleanup:
  enabled: false
  deprecatedConditions: []
  # - "OldConditionType1"
  # - "OldConditionType2"
  image:
    repository: docker.io/bitnamilegacy/kubectl
    tag: "1.30.6"
    pullPolicy: IfNotPresent
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

# PostgreSQL subchart configuration
# Only enabled when using PostgreSQL as the datastore
# See values-postgresql.yaml for a complete PostgreSQL configuration example
postgresql:
  enabled: false
